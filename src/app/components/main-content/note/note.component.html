<!-- Einzelne Notiz-Komponente

    Anzeige und Bearbeitung von Notizen
    Farbauswahl
    Label-Verwaltung
    AnhÃ¤nge-Verwaltung -->

<!-- note.component.html -->
<div [style.background-color]="note.color">
    <span>{{ note.isPinned ? 'ðŸ“Œ' : '' }}</span>
    <button (click)="togglePinNote();saveNote()">Pinnen</button>

    <app-editing-note *ngIf="isEditing && editedNote" [note]="editedNote" (save)="saveNote()"
        (cancel)="abortEditNote()">
    </app-editing-note>

    <div *ngIf="!isEditing">
        <h3>{{ note.title }} </h3>
        <p *ngIf="!note.isChecklist">{{ note.content }}</p>
        <ng-container *ngIf="note.isChecklist">
            <ul cdkDropList (cdkDropListDropped)="onDrop($event, false);saveNote()">
                <li *ngFor="let item of uncheckedItems; let i = index" cdkDrag>
                    <div class="drag-handle">â‹®</div>
                    <input type="checkbox" [(ngModel)]="item.checked" (change)="onCheckboxChange(item.id);saveNote()">
                    <span>{{ item.text }}</span>
                </li>
            </ul>
            <div *ngIf="checkedItems.length > 0" class="completed-items">
                <button (click)="toggleCompletedItems()" class="toggle-button">
                    {{ isCompletedItemsVisible ? 'â–¼' : 'â–¶' }}
                </button>
                {{ checkedItems.length }} Abgeschlossene {{ checkedItems.length === 1 ? 'Element' : 'Elemente' }}
            </div>
            <ul *ngIf="isCompletedItemsVisible" cdkDropList (cdkDropListDropped)="onDrop($event, true);saveNote()">
                <li *ngFor="let item of checkedItems; let i = index" cdkDrag>
                    <div class="drag-handle">â‹®</div>
                    <input type="checkbox" [(ngModel)]="item.checked" (change)="onCheckboxChange(item.id);saveNote()">
                    <span class="completed">{{ item.text }}</span>
                </li>
            </ul>
        </ng-container>
        <button (click)="editNote()">Bearbeiten</button>
    </div>

    <div>
        <div class="color-selector" (click)="toggleDropdown()">
            <img class="icon" [style.backgroundColor]="selectedColor" src="assets/icons/color-white.svg" alt="">
            <div class="dropdown-menu" *ngIf="isDropdownOpen">
                <div *ngFor="let color of colors" class="dropdown-item icon" [style.backgroundColor]="color.value"
                    (click)="selectColor(color.value);toggleDropdown();saveNote()">
                </div>
            </div>
        </div>
    </div>

    <input type="file" (change)="onFileSelected($event);this.saveNote()" accept="image/*" multiple #fileInput>

    <div *ngIf="note.attachments.length > 0">
        <h4>AnhÃ¤nge:</h4>
        <div *ngFor="let attachment of note.attachments; let i = index">
            <img [src]="attachment.url" alt="Attachment" style="max-width: 200px; max-height: 200px;">
            <p>{{ attachment.name }} ({{ attachment.size | number }} bytes)</p>
            <button (click)="removeAttachment(attachment.id); saveNote()">Entfernen</button>
        </div>
    </div>
    <button (click)="deleteNote()">LÃ¶schen</button>
    <ng-container *ngIf="note.editAt == null; else edited">
        <p>Erstellt am: {{ note.createdAt | date:'medium' }}</p>
    </ng-container>
    <ng-template #edited>
        <p>Bearbeitet am: {{ note.editAt | date:'medium' }}</p>
    </ng-template>
</div>