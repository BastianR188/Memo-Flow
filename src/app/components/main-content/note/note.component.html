<!-- Einzelne Notiz-Komponente

    Anzeige und Bearbeitung von Notizen
    Farbauswahl
    Label-Verwaltung
    Anhänge-Verwaltung -->

<!-- note.component.html -->
<div [style.background-color]="note.color" class="note-main-container">
    <div *ngIf="!note.delete">
        <span class="pinn">
            <img *ngIf="note.isPinned" class="icon" (click)="togglePinNote();saveNote()"
                src="assets/icons/pin-black.svg" alt="Pinned">
            <img *ngIf="!note.isPinned" class="icon" (click)="togglePinNote();saveNote()"
                src="assets/icons/pin-white.svg" alt="Not pinned">
        </span>
    </div>
    <app-editing-note *ngIf="isEditing && editedNote" [note]="editedNote" (save)="saveNote()"
        (cancel)="abortEditNote()">
    </app-editing-note>

    <div *ngIf="!isEditing">
        <h3>{{ note.title }} </h3>
        <p *ngIf="!note.isChecklist">{{ note.content }}</p>
        <ng-container *ngIf="note.isChecklist">
            <div cdkDropList (cdkDropListDropped)="onDrop($event, false);saveNote()">
                <div *ngFor="let item of uncheckedItems; let i = index" cdkDrag>
                    <div class="drag-handle">⋮</div>
                    <input type="checkbox" [(ngModel)]="item.checked" (change)="onCheckboxChange(item.id);saveNote()">
                    <span>{{ item.text }}</span>
                </div>
            </div>
            <div *ngIf="checkedItems.length > 0" class="completed-items">
                <!-- <button (click)="toggleCompletedItems()" class="toggle-button">
                    {{ isCompletedItemsVisible ? '▼' : '▶' }}
                </button>
                {{ checkedItems.length }} Abgeschlossene {{ checkedItems.length === 1 ? 'Element' : 'Elemente' }} -->
            </div>
            <div *ngIf="isCompletedItemsVisible" cdkDropList (cdkDropListDropped)="onDrop($event, true);saveNote()">
            <div *ngFor="let item of checkedItems; let i = index" cdkDrag>
                <div class="drag-handle">⋮</div>
                <input type="checkbox" [(ngModel)]="item.checked" (change)="onCheckboxChange(item.id);saveNote()">
                <span class="completed">{{ item.text }}</span>
            </div>
            </div> 
        </ng-container>
    </div>




    <div *ngIf="note.attachments.length > 0">
        <div *ngFor="let attachment of note.attachments; let i = index" class="main-attachment">
            <img [src]="attachment.url" alt="Attachment" style="max-width: 200px; max-height: 200px;">
            <img class="icon close" (click)="removeAttachment(attachment.id); saveNote()" src=".\assets\icons\close.svg"
                alt="">
        </div>
    </div>

    <div>
        <div *ngIf="!note.delete" class="footer-note">
            <div>
                <div class="color-selector" (click)="toggleDropdown()">
                    <img class="icon" src="assets/icons/color-white.svg" alt="">
                    <div class="dropdown-menu" *ngIf="isDropdownOpen">
                        <div *ngFor="let color of colors" class="dropdown-item icon"
                            [style.backgroundColor]="color.value"
                            (click)="selectColor(color.value);toggleDropdown();saveNote()">
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <img class="icon" src="assets/icons/img-white.svg" alt="" (click)="fileInput.click()">
                <input type="file" #fileInput (change)="onFileSelected($event);this.saveNote()" multiple
                    accept="image/*" style="display: none;">
            </div>

            <button mat-button [matMenuTriggerFor]="menu" class="nopad"><img class="icon"
                    src=".\assets\icons\menu-vertical.svg" alt=""></button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="editNote()">Bearbeiten</button>
                <button mat-menu-item (click)="deleteNote()">Papierkorb verschieben</button>
            </mat-menu>
        </div>
        <div *ngIf="note.delete" class="footer-note">
            <button (click)="noteService.deleteNotePermanently(note.id)">Endgültig Löschen</button>
            <button (click)="noteService.restoreNoteFromTrash(note)">Wiederherstellen</button>
        </div>
    </div>
    <!-- <ng-container *ngIf="note.editAt == null; else edited">
        <p>Erstellt am: {{ note.createdAt | date:'medium' }}</p>
    </ng-container>
    <ng-template #edited>
        <span>Bearbeitet am:</span>
        <p>{{ note.editAt | date:'medium' }}</p>
    </ng-template> -->
</div>